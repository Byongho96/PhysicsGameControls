import{Vector3 as t,Plane as i,Line3 as e,Sphere as s,Box3 as n,Triangle as o,Layers as a,Controls as r,Ray as h,Quaternion as c,PerspectiveCamera as l,OrthographicCamera as d,Spherical as u,AnimationMixer as m,LoopOnce as _,LineSegments as p,CapsuleGeometry as y,LineBasicMaterial as A}from"three";function v(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}function b(t,i){for(var e=0;e<i.length;e++){var s=i[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,T(s.key),s)}}function g(t,i,e){return i&&b(t.prototype,i),e&&b(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function T(t){var i=function(t,i){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var s=e.call(t,i||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===i?String:Number)(t)}(t,"string");return"symbol"==typeof i?i:i+""}var f=function(){function i(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new t(0,0,0),s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new t(0,1,0),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;v(this,i),this.start=e,this.end=s,this.radius=n}return g(i,[{key:"clone",value:function(){return new i(this.start.clone(),this.end.clone(),this.radius)}},{key:"set",value:function(t,i,e){this.start.copy(t),this.end.copy(i),this.radius=e}},{key:"copy",value:function(t){this.start.copy(t.start),this.end.copy(t.end),this.radius=t.radius}},{key:"getCenter",value:function(t){return t.copy(this.end).add(this.start).multiplyScalar(.5)}},{key:"translate",value:function(t){this.start.add(t),this.end.add(t)}},{key:"checkAABBAxis",value:function(t,i,e,s,n,o,a,r,h){return(n-t<h||n-e<h)&&(t-o<h||e-o<h)&&(a-i<h||a-s<h)&&(i-r<h||s-r<h)}},{key:"intersectsBox",value:function(t){return this.checkAABBAxis(this.start.x,this.start.y,this.end.x,this.end.y,t.min.x,t.max.x,t.min.y,t.max.y,this.radius)&&this.checkAABBAxis(this.start.x,this.start.z,this.end.x,this.end.z,t.min.x,t.max.x,t.min.z,t.max.z,this.radius)&&this.checkAABBAxis(this.start.y,this.start.z,this.end.y,this.end.z,t.min.y,t.max.y,t.min.z,t.max.z,this.radius)}}])}(),E=new t,O=new t,x=new t,M=new t,R=new i,w=new e,D=new e,L=new s,S=new f,W=new t,k=new t,P=new t;function j(t,i){var e,s,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=W.copy(t.end).sub(t.start),r=k.copy(i.end).sub(i.start),h=P.copy(i.start).sub(t.start),c=a.dot(r),l=a.dot(a),d=r.dot(r),u=r.dot(h),m=a.dot(h),_=l*d-c*c;if(Math.abs(_)<1e-10){var p=-u/d,y=(c-u)/d;Math.abs(p-.5)<Math.abs(y-.5)?(e=0,s=p):(e=1,s=y)}else s=((e=(u*c+m*d)/_)*c-u)/d;s=Math.max(0,Math.min(1,s)),e=Math.max(0,Math.min(1,e)),n&&n.copy(a).multiplyScalar(e).add(t.start),o&&o.copy(r).multiplyScalar(s).add(i.start)}var V=function(){function i(t){v(this,i),this.box=t,this.bounds=new n,this.subTrees=[],this.triangles=[],this.layers=new a}return g(i,[{key:"addTriangle",value:function(t){return this.bounds.min.x=Math.min(this.bounds.min.x,t.a.x,t.b.x,t.c.x),this.bounds.min.y=Math.min(this.bounds.min.y,t.a.y,t.b.y,t.c.y),this.bounds.min.z=Math.min(this.bounds.min.z,t.a.z,t.b.z,t.c.z),this.bounds.max.x=Math.max(this.bounds.max.x,t.a.x,t.b.x,t.c.x),this.bounds.max.y=Math.max(this.bounds.max.y,t.a.y,t.b.y,t.c.y),this.bounds.max.z=Math.max(this.bounds.max.z,t.a.z,t.b.z,t.c.z),this.triangles.push(t),this}},{key:"calcBox",value:function(){return this.box=this.bounds.clone(),this.box.min.x-=.01,this.box.min.y-=.01,this.box.min.z-=.01,this}},{key:"split",value:function(t){if(this.box){for(var e,s=[],o=O.copy(this.box.max).sub(this.box.min).multiplyScalar(.5),a=0;a<2;a++)for(var r=0;r<2;r++)for(var h=0;h<2;h++){var c=new n,l=E.set(a,r,h);c.min.copy(this.box.min).add(l.multiply(o)),c.max.copy(c.min).add(o),s.push(new i(c))}for(;e=this.triangles.pop();)for(var d=0;d<s.length;d++)s[d].box.intersectsTriangle(e)&&s[d].triangles.push(e);for(var u=0;u<s.length;u++){var m=s[u].triangles.length;m>8&&t<16&&s[u].split(t+1),0!==m&&this.subTrees.push(s[u])}return this}}},{key:"build",value:function(){return this.calcBox(),this.split(0),this}},{key:"getRayTriangles",value:function(t,i){for(var e=0;e<this.subTrees.length;e++){var s=this.subTrees[e];if(t.intersectsBox(s.box))if(s.triangles.length>0)for(var n=0;n<s.triangles.length;n++)-1===i.indexOf(s.triangles[n])&&i.push(s.triangles[n]);else s.getRayTriangles(t,i)}return i}},{key:"triangleCapsuleIntersect",value:function(t,i){i.getPlane(R);var e=R.distanceToPoint(t.start)-t.radius,s=R.distanceToPoint(t.end)-t.radius;if(e>0&&s>0||e<-t.radius&&s<-t.radius)return!1;var n=Math.abs(e/(Math.abs(e)+Math.abs(s))),o=E.copy(t.start).lerp(t.end,n);if(i.containsPoint(o))return{normal:R.normal.clone(),point:o.clone(),depth:Math.abs(Math.min(e,s))};for(var a=t.radius*t.radius,r=w.set(t.start,t.end),h=[[i.a,i.b],[i.b,i.c],[i.c,i.a]],c=0;c<h.length;c++){if(j(r,D.set(h[c][0],h[c][1]),x,M),x.distanceToSquared(M)<a)return{normal:x.clone().sub(M).normalize(),point:M.clone(),depth:t.radius-x.distanceTo(M)}}return!1}},{key:"triangleSphereIntersect",value:function(t,i){if(i.getPlane(R),!t.intersectsPlane(R))return!1;var e=Math.abs(R.distanceToSphere(t)),s=t.radius*t.radius-e*e,n=R.projectPoint(t.center,E);if(i.containsPoint(t.center))return{normal:R.normal.clone(),point:n.clone(),depth:Math.abs(R.distanceToSphere(t))};for(var o=[[i.a,i.b],[i.b,i.c],[i.c,i.a]],a=0;a<o.length;a++){w.set(o[a][0],o[a][1]),w.closestPointToPoint(n,!0,O);var r=O.distanceToSquared(t.center);if(r<s)return{normal:t.center.clone().sub(O).normalize(),point:O.clone(),depth:t.radius-Math.sqrt(r)}}return!1}},{key:"getSphereTriangles",value:function(t,i){for(var e=0;e<this.subTrees.length;e++){var s=this.subTrees[e];if(t.intersectsBox(s.box))if(s.triangles.length>0)for(var n=0;n<s.triangles.length;n++)-1===i.indexOf(s.triangles[n])&&i.push(s.triangles[n]);else s.getSphereTriangles(t,i)}}},{key:"getCapsuleTriangles",value:function(t,i){for(var e=0;e<this.subTrees.length;e++){var s=this.subTrees[e];if(t.intersectsBox(s.box))if(s.triangles.length>0)for(var n=0;n<s.triangles.length;n++)-1===i.indexOf(s.triangles[n])&&i.push(s.triangles[n]);else s.getCapsuleTriangles(t,i)}}},{key:"sphereIntersect",value:function(t){L.copy(t);var i,e=[],s=!1;this.getSphereTriangles(t,e);for(var n=0;n<e.length;n++)(i=this.triangleSphereIntersect(L,e[n]))&&(s=!0,L.center.add(i.normal.multiplyScalar(i.depth)));if(s){var o=L.center.clone().sub(t.center),a=o.length();return{normal:o.normalize(),depth:a}}return!1}},{key:"capsuleIntersect",value:function(i){S.copy(i);var e,s=[],n=!1;this.getCapsuleTriangles(S,s);for(var o=0;o<s.length;o++)(e=this.triangleCapsuleIntersect(S,s[o]))&&(n=!0,S.translate(e.normal.multiplyScalar(e.depth)));if(n){var a=S.getCenter(new t).sub(i.getCenter(E)),r=a.length();return{normal:a.normalize(),depth:r}}return!1}},{key:"rayIntersect",value:function(t){if(0!==t.direction.length()){var i,e,s=[],n=1e100;this.getRayTriangles(t,s);for(var o=0;o<s.length;o++){var a=t.intersectTriangle(s[o].a,s[o].b,s[o].c,!0,E);if(a){var r=a.sub(t.origin).length();n>r&&(e=a.clone().add(t.origin),n=r,i=s[o])}}return n<1e100&&{distance:n,triangle:i,position:e}}}},{key:"fromGraphNode",value:function(i){var e=this;return i.updateWorldMatrix(!0,!0),i.traverse((function(i){if(!0===i.isMesh&&e.layers.test(i.layers)){var s,n=!1;null!==i.geometry.index?(n=!0,s=i.geometry.toNonIndexed()):s=i.geometry;for(var a=s.getAttribute("position"),r=0;r<a.count;r+=3){var h=(new t).fromBufferAttribute(a,r),c=(new t).fromBufferAttribute(a,r+1),l=(new t).fromBufferAttribute(a,r+2);h.applyMatrix4(i.matrixWorld),c.applyMatrix4(i.matrixWorld),l.applyMatrix4(i.matrixWorld),e.addTriangle(new o(h,c,l))}n&&s.dispose()}})),this.build(),this}},{key:"clear",value:function(){return this.box=null,this.bounds.makeEmpty(),this.subTrees.length=0,this.triangles.length=0,this}}])}();class F extends f{constructor(i,e,s){super(i,e,s),this._center=new t}get length(){return this.start.distanceTo(this.end)}set length(t){const i=this.getCenter(this._center),e=this.end.clone().sub(this.start).normalize().multiplyScalar(t/2);this.start.copy(i).sub(e),this.end.copy(i).add(e)}}const C={type:"collide"};class z extends r{constructor(i,e=null,s=null){super(i,e),this.worldOctree=new V,this.gravity=30,this.maxFallSpeed=20,this.resistance=6,this.velocity=new t,this.step=5,this.landTimeThreshold=.3,this.landTolerance=.2,this.collider=new F,this.resetPoint=new t,this.minXBoundary=-1/0,this.maxXBoundary=1/0,this.minYBoundary=-1/0,this.maxYBoundary=1/0,this.minZBoundary=-1/0,this.maxZBoundary=1/0,this._isLanding=!1,this._isGrounded=!1,this._ray=new h(new t,new t(0,-1,0)),this._distance=new t,this._objectWorldPosition=new t,this._objectWorldQuaternion=new c,this._colliderLocalPosition=new t,this._world=s,s&&this.worldOctree.fromGraphNode(s)}get world(){return this._world}set world(t){this._world=t,t&&this.worldOctree.fromGraphNode(t)}get isLanding(){return this._isLanding}get isGrounded(){return this._isGrounded}getLocalVelocity(t){return this.object.getWorldQuaternion(this._objectWorldQuaternion),t.copy(this.velocity).applyQuaternion(this._objectWorldQuaternion.invert())}_checkCollisions(){this._isGrounded=!1;const t=this.worldOctree.capsuleIntersect(this.collider);t&&(t.normal.y>0&&(this._isGrounded=!0,this.velocity.y=0),t.depth>=1e-10&&(this.collider.translate(t.normal.multiplyScalar(t.depth)),this.dispatchEvent({...C,normal:t.normal.normalize()})))}_checkIsLanding(){if(this._isLanding=!1,this._isGrounded||this.velocity.y>=0)return;this._ray.origin.copy(this.collider.start).y-=this.collider.radius;const t=this.worldOctree.rayIntersect(this._ray),i=Math.min((this.maxFallSpeed+this.velocity.y)/this.gravity,this.landTimeThreshold),e=(-this.velocity.y+.5*this.gravity*i)*i,s=this.landTimeThreshold-i,n=this.maxFallSpeed*s;this.landTolerance<t.distance&&t.distance<e+n&&(this._isLanding=!0)}_teleportPlayerIfOutOfBounds(){const{x:t,y:i,z:e}=this.object.getWorldPosition(this._objectWorldPosition);(t<this.minXBoundary||t>this.maxXBoundary||i<this.minYBoundary||i>this.maxYBoundary||e<this.minZBoundary||e>this.maxZBoundary)&&(this.collider.translate(this._distance.subVectors(this.resetPoint,this._objectWorldPosition)),this.velocity.set(0,0,0))}update(t){if(super.update(t),!this.enabled)return;const i=t/this.step;for(let t=0;t<this.step;t++){let t=Math.exp(-this.resistance*i)-1;this._isGrounded||(this.velocity.y-=this.gravity*i,this.velocity.y=Math.max(this.velocity.y,-this.maxFallSpeed),t*=.1),this.velocity.x+=t*this.velocity.x,this.velocity.z+=t*this.velocity.z,this._distance.copy(this.velocity).multiplyScalar(i),this.collider.translate(this._distance),this._checkCollisions()}this._checkIsLanding(),this._teleportPlayerIfOutOfBounds(),this._colliderLocalPosition.copy(this.collider.start),this._colliderLocalPosition.y-=this.collider.radius,this.object.parent&&this.object.parent.worldToLocal(this._colliderLocalPosition),this.object.position.copy(this._colliderLocalPosition)}}const B=new t(0,1,0);class I extends z{constructor(i,e=null,s=null){super(i,e,s),this.actionStates={MOVE_FORWARD:0,MOVE_BACKWARD:0,MOVE_LEFTWARD:0,MOVE_RIGHTWARD:0,JUMP:0,ACCELERATE:0,ROTATE_UP:0,ROTATE_DOWN:0,ROTATE_RIGHT:0,ROTATE_LEFT:0},this.eyeHeight=1.6,this.jumpForce=15,this.groundedMoveSpeed=30,this.floatingMoveSpeed=8,this.rotateSpeed=1,this.maxTiltAngle=Math.PI/2,this.minTiltAngle=-Math.PI/2,this.enableAcceleration=!0,this.accelerationFactor=1.5,this.enableZoom=!0,this.zoomSpeed=1,this.minZoom=0,this.maxZoom=1/0,this._movementVector=new t,this._objectLocalVector=new t,this._bindOnMouseWheel=this._onMouseWheel.bind(this),this.object.rotation.order="YZX",this.collider.radius=this.eyeHeight/4,this.collider.length=this.eyeHeight/2,this.connect()}getForwardVector(t){return this.object.getWorldDirection(t),t.y=0,t.normalize(),t}getRightwardVector(t){return this.object.getWorldDirection(t),t.y=0,t.cross(B),t.normalize(),t}_updateMovement(t){let i=t*(this.isGrounded?this.groundedMoveSpeed:this.floatingMoveSpeed);this.enableAcceleration&&this.actionStates.ACCELERATE&&(i*=this.accelerationFactor),this._movementVector.set(0,0,0),this.actionStates.MOVE_FORWARD&&this._movementVector.add(this.getForwardVector(this._objectLocalVector).multiplyScalar(this.actionStates.MOVE_FORWARD*i)),this.actionStates.MOVE_BACKWARD&&this._movementVector.sub(this.getForwardVector(this._objectLocalVector).multiplyScalar(this.actionStates.MOVE_BACKWARD*i)),this.actionStates.MOVE_RIGHTWARD&&this._movementVector.add(this.getRightwardVector(this._objectLocalVector).multiplyScalar(this.actionStates.MOVE_RIGHTWARD*i)),this.actionStates.MOVE_LEFTWARD&&this._movementVector.sub(this.getRightwardVector(this._objectLocalVector).multiplyScalar(this.actionStates.MOVE_LEFTWARD*i)),this.actionStates.JUMP&&this.isGrounded&&this._movementVector.addScaledVector(B,this.jumpForce),this.velocity.add(this._movementVector)}_updateRotation(t){const i=this.rotateSpeed*t/5;this.actionStates.ROTATE_UP&&this.object.rotateX(this.actionStates.ROTATE_UP*i),this.actionStates.ROTATE_DOWN&&this.object.rotateX(-this.actionStates.ROTATE_DOWN*i),this.actionStates.ROTATE_RIGHT&&this.object.rotateOnWorldAxis(B,-this.actionStates.ROTATE_RIGHT*i),this.actionStates.ROTATE_LEFT&&this.object.rotateOnWorldAxis(B,this.actionStates.ROTATE_LEFT*i),this.object.rotation.x=Math.max(this.minTiltAngle,Math.min(this.maxTiltAngle,this.object.rotation.x))}update(t){super.update(t),this.object.position.y+=this.eyeHeight,this._updateMovement(t),this._updateRotation(t)}connect(){var t;super.connect(),null===(t=this.domElement)||void 0===t||t.addEventListener("wheel",this._bindOnMouseWheel)}disconnect(){var t;super.disconnect(),null===(t=this.domElement)||void 0===t||t.removeEventListener("wheel",this._bindOnMouseWheel)}_onMouseWheel(t){if(!this.enableZoom)return;if(!(this.object instanceof l||this.object instanceof d))return console.warn("WARNING: FirstPersonControls.js encountered an unknown camera type - dolly/zoom disabled."),void(this.enableZoom=!1);const i=Math.pow(.95,this.zoomSpeed*Math.abs(.01*t.deltaY));t.deltaY>0?this.object.zoom*=i:t.deltaY<0&&(this.object.zoom/=i),this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom)),this.object.updateProjectionMatrix()}}const K=new t(0,1,0);class G extends I{constructor(i,e=null,s=null,o={},a=null){super(i,e,s),this._animationClips={},this._animationActions={},this.eyeHeight=0,this.transitionTime=.3,this.transitionDelay=.3,this.fallSpeedThreshold=15,this.moveSpeedThreshold=1,this.runSpeedThreshold=8,this.cameraLerpFactor=1,this.enableRotationOnMove=!0,this.syncAxisWithCamera="MOVE",this._spherical=new u,this._forwardDirection=new t,this._objectLocalVelocity=new t,this._objectLookAtPosition=new t,this._movementDirection=new t,this._currentActionKey=null,this._cameraLookAtPosition=new t,this._cameraOffsetPosition=new t,this._animationMixer=new m(this.object),Object.entries(o).forEach((([t,i])=>{this.setAnimationClip(t,i)})),this.camera=a;const r=new t;(new n).setFromObject(this.object).getSize(r),this.cameraPositionOffset=new t(0,1.5*r.y,1.5*-r.y),this.cameraLookAtOffset=new t(0,.8*r.y,0);const h=this.cameraPositionOffset.clone().sub(this.cameraLookAtOffset);this._spherical.setFromVector3(h),this.collider.radius=r.y/4,this.collider.length=r.y/2}get animationClips(){return Object.freeze({...this._animationClips})}getForwardVector(t){return t.copy(this._forwardDirection),t}getRightwardVector(t){return t.copy(this._forwardDirection),t.cross(K),t}setAnimationClip(t,i){const e=this._animationMixer.clipAction(i);this._animationClips[t]=i,this._animationActions[t]=e}deleteAnimationClip(t){const i=this._animationClips[t],e=this._animationActions[t];e&&(e.stop(),this._animationMixer.uncacheAction(i,this.object),delete this._animationActions[t]),i&&(this._animationMixer.uncacheClip(i),delete this._animationClips[t])}getAnimationAction(t){return this._animationActions[t]}_fadeToAction(t,i,e){if(t===this._currentActionKey)return;const s=this._animationActions[t];if(!s)return;const n=this._currentActionKey?this._animationActions[this._currentActionKey]:null;n&&n.fadeOut(i),s.reset(),e&&(s.setLoop(_,1),s.clampWhenFinished=!0),s.fadeIn(i),s.play(),this._currentActionKey=t}_syncForwardDirection(){if(this.camera&&"NEVER"!==this.syncAxisWithCamera)return"ALWAYS"===this.syncAxisWithCamera||this.actionStates.MOVE_FORWARD||this.actionStates.MOVE_BACKWARD||this.actionStates.MOVE_LEFTWARD||this.actionStates.MOVE_RIGHTWARD?(this.camera.getWorldDirection(this._forwardDirection),this._forwardDirection.y=0,void this._forwardDirection.normalize()):void 0}_updateObjectDirection(){return this._movementDirection.copy(this.velocity),this._movementDirection.y=0,this.object.getWorldPosition(this._objectLookAtPosition),this._movementDirection.length()>.01&&this.enableRotationOnMove?(this._objectLookAtPosition.add(this._movementDirection),void this.object.lookAt(this._objectLookAtPosition)):"ALWAYS"===this.syncAxisWithCamera||this._movementDirection.length()>.01?(this._objectLookAtPosition.add(this._forwardDirection),void this.object.lookAt(this._objectLookAtPosition)):void 0}_lerpCameraPosition(){this.camera&&(this._spherical.radius=this.cameraPositionOffset.distanceTo(this.cameraLookAtOffset),this.object.getWorldPosition(this._cameraLookAtPosition).add(this.cameraLookAtOffset),this._cameraOffsetPosition.setFromSpherical(this._spherical).add(this._cameraLookAtPosition),this.camera.position.lerp(this._cameraOffsetPosition,this.cameraLerpFactor),this.camera.lookAt(this._cameraLookAtPosition),this.camera.updateMatrixWorld())}_updateAnimation(){return this.getLocalVelocity(this._objectLocalVelocity),this._objectLocalVelocity.y>0&&this._animationActions.JUMP_UP?this._fadeToAction("JUMP_UP",this.transitionTime,!0):this.isLanding&&this._animationActions.LAND?this._fadeToAction("LAND",this.transitionTime,!0):this.velocity.y<-this.fallSpeedThreshold&&"LAND"!==this._currentActionKey&&this._animationActions.FALL?this._fadeToAction("FALL",this.transitionTime):this.isGrounded?this._objectLocalVelocity.z>this.runSpeedThreshold&&this._animationActions.RUN_FORWARD?this._fadeToAction("RUN_FORWARD",this.transitionTime):this._objectLocalVelocity.z>this.moveSpeedThreshold&&this._animationActions.MOVE_FORWARD?this._fadeToAction("MOVE_FORWARD",this.transitionTime):this._objectLocalVelocity.z<-this.runSpeedThreshold&&this._animationActions.RUN_BACKWARD?this._fadeToAction("RUN_BACKWARD",this.transitionTime):this._objectLocalVelocity.z<-this.moveSpeedThreshold&&this._animationActions.MOVE_BACKWARD?this._fadeToAction("MOVE_BACKWARD",this.transitionTime):this._objectLocalVelocity.x<-this.runSpeedThreshold&&this._animationActions.RUN_RIGHTWARD?this._fadeToAction("RUN_RIGHTWARD",this.transitionTime):this._objectLocalVelocity.x<-this.moveSpeedThreshold&&this._animationActions.MOVE_RIGHTWARD?this._fadeToAction("MOVE_RIGHTWARD",this.transitionTime):this._objectLocalVelocity.x>this.runSpeedThreshold&&this._animationActions.RUN_LEFTWARD?this._fadeToAction("RUN_LEFTWARD",this.transitionTime):this._objectLocalVelocity.x>this.moveSpeedThreshold&&this._animationActions.MOVE_LEFTWARD?this._fadeToAction("MOVE_LEFTWARD",this.transitionTime):this._fadeToAction("IDLE",this.transitionTime):void 0}_updateRotation(t){const i=this.rotateSpeed*t;this.actionStates.ROTATE_UP&&(this._spherical.phi+=this.actionStates.ROTATE_UP*i),this.actionStates.ROTATE_DOWN&&(this._spherical.phi-=this.actionStates.ROTATE_DOWN*i),this.actionStates.ROTATE_RIGHT&&(this._spherical.theta-=this.actionStates.ROTATE_RIGHT*i),this.actionStates.ROTATE_LEFT&&(this._spherical.theta+=this.actionStates.ROTATE_LEFT*i);const e=this.maxTiltAngle+Math.PI/2,s=this.minTiltAngle+Math.PI/2;this._spherical.phi=Math.max(s,Math.min(e,this._spherical.phi)),this._spherical.makeSafe()}update(t){super.update(t),this._updateAnimation(),this._animationMixer.update(t),this._syncForwardDirection(),this._updateObjectDirection(),this._lerpCameraPosition()}dispose(){super.dispose(),this._animationMixer.stopAllAction(),this._animationMixer.uncacheRoot(this.object)}_onMouseWheel(t){if(!this.enableZoom)return;if(!(this.camera instanceof l||this.camera instanceof d))return console.warn("WARNING: FirstPersonControls.js encountered an unknown camera type - dolly/zoom disabled."),void(this.enableZoom=!1);const i=Math.pow(.95,this.zoomSpeed*Math.abs(.01*t.deltaY));t.deltaY>0?this.camera.zoom*=i:t.deltaY<0&&(this.camera.zoom/=i),this.camera.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.camera.zoom)),this.camera.updateProjectionMatrix()}}function U(t){return class extends t{constructor(...t){super(...t),this.keyToActions={KeyW:["MOVE_FORWARD"],KeyS:["MOVE_BACKWARD"],KeyA:["MOVE_LEFTWARD"],KeyD:["MOVE_RIGHTWARD"],Space:["JUMP"],ShiftLeft:["ACCELERATE"]},this._bindOnKeyDown=this._onKeyDown.bind(this),this._bindOnKeyUp=this._onKeyUp.bind(this),this._bindOnBlur=this._onBlur.bind(this),this.connect()}connect(){super.connect(),window.addEventListener("keydown",this._bindOnKeyDown),window.addEventListener("keyup",this._bindOnKeyUp),window.addEventListener("blur",this._bindOnBlur)}disconnect(){super.disconnect(),window.removeEventListener("keydown",this._bindOnKeyDown),window.removeEventListener("keyup",this._bindOnKeyUp),window.removeEventListener("blur",this._bindOnBlur)}dispose(){super.dispose(),this.disconnect()}_onKeyDown(t){t.code in this.keyToActions&&this.keyToActions[t.code].forEach((t=>{this.actionStates[t]=1}))}_onKeyUp(t){t.code in this.keyToActions&&this.keyToActions[t.code].forEach((t=>{this.actionStates[t]=0}))}_onBlur(){Object.keys(this.keyToActions).forEach((t=>{this.keyToActions[t].forEach((t=>{this.actionStates[t]=0}))}))}}}class N extends(U(I)){constructor(){super(...arguments),this.keyToActions={KeyW:["MOVE_FORWARD"],KeyS:["MOVE_BACKWARD"],KeyA:["MOVE_LEFTWARD"],KeyD:["MOVE_RIGHTWARD"],Space:["JUMP"],ShiftLeft:["ACCELERATE"],ArrowUp:["ROTATE_UP"],ArrowDown:["ROTATE_DOWN"],ArrowRight:["ROTATE_RIGHT"],ArrowLeft:["ROTATE_LEFT"]}}}function Y(t){return class extends t{constructor(...t){super(...t),this.dragXActions=["ROTATE_RIGHT"],this.dragYActions=["ROTATE_DOWN"],this.dragDampingFactor=1,this.enableDragDamping=!0,this._isDragging=!1,this._lastTouchX=0,this._lastTouchY=0,this._bindOnDragStart=this._onDragStart.bind(this),this._bindOnDragEnd=this._onDragEnd.bind(this),this._bindOnDragMove=this._onDragMove.bind(this),this.connect()}connect(){var t,i,e,s;super.connect(),null===(t=this.domElement)||void 0===t||t.addEventListener("mousedown",this._bindOnDragStart),document.addEventListener("mouseup",this._bindOnDragEnd),null===(i=this.domElement)||void 0===i||i.addEventListener("mousemove",this._bindOnDragMove),null===(e=this.domElement)||void 0===e||e.addEventListener("touchstart",this._bindOnDragStart),document.addEventListener("touchend",this._bindOnDragEnd),null===(s=this.domElement)||void 0===s||s.addEventListener("touchmove",this._bindOnDragMove)}disconnect(){var t,i,e,s;super.disconnect(),null===(t=this.domElement)||void 0===t||t.removeEventListener("mousedown",this._bindOnDragStart),document.removeEventListener("mouseup",this._bindOnDragEnd),null===(i=this.domElement)||void 0===i||i.removeEventListener("mousemove",this._bindOnDragMove),null===(e=this.domElement)||void 0===e||e.removeEventListener("touchstart",this._bindOnDragStart),document.removeEventListener("touchend",this._bindOnDragEnd),null===(s=this.domElement)||void 0===s||s.removeEventListener("touchmove",this._bindOnDragMove)}dispose(){super.dispose(),this.disconnect()}update(t){super.update(t),this.enableDragDamping&&(this.dragXActions.forEach((t=>{this.actionStates[t]*=1-this.dragDampingFactor})),this.dragYActions.forEach((t=>{this.actionStates[t]*=1-this.dragDampingFactor})))}_onDragStart(t){if(this._isDragging=!0,t instanceof TouchEvent){const i=t.touches[0];if(!i)return;this._lastTouchX=i.clientX,this._lastTouchY=i.clientY}}_onDragEnd(){this._isDragging=!1}_onDragMove(t){if(!this._isDragging)return;let i=0,e=0;if(t instanceof MouseEvent)i=t.movementX,e=t.movementY;else if(t instanceof TouchEvent){const s=t.touches[0];if(!s)return;i=s.clientX-this._lastTouchX,e=s.clientY-this._lastTouchY,this._lastTouchX=s.clientX,this._lastTouchY=s.clientY}this.dragXActions.forEach((t=>{this.actionStates[t]=i})),this.dragYActions.forEach((t=>{this.actionStates[t]=e}))}}}class H extends(U(Y(I))){}function X(t){return class extends t{constructor(...t){super(...t),this.pointerLockXActions=["ROTATE_RIGHT"],this.pointerLockYActions=["ROTATE_DOWN"],this.pointerLockDampingFactor=1,this.enablePointerLockDamping=!0,this._bindOnMouseDown=this._onMouseDown.bind(this),this._bindOnMouseMove=this._onMouseMove.bind(this),this.connect()}connect(){var t,i;super.connect(),null===(t=this.domElement)||void 0===t||t.addEventListener("mousedown",this._bindOnMouseDown),null===(i=this.domElement)||void 0===i||i.addEventListener("mousemove",this._bindOnMouseMove)}disconnect(){var t,i;super.disconnect(),null===(t=this.domElement)||void 0===t||t.removeEventListener("mousedown",this._bindOnMouseDown),null===(i=this.domElement)||void 0===i||i.removeEventListener("mousemove",this._bindOnMouseMove)}dispose(){super.dispose(),this.disconnect()}update(t){super.update(t),this.enablePointerLockDamping&&(this.pointerLockXActions.forEach((t=>{this.actionStates[t]*=1-this.pointerLockDampingFactor})),this.pointerLockYActions.forEach((t=>{this.actionStates[t]*=1-this.pointerLockDampingFactor})))}_onMouseDown(){var t;null===(t=this.domElement)||void 0===t||t.requestPointerLock()}_onMouseMove(t){document.pointerLockElement===this.domElement&&(this.pointerLockXActions.forEach((i=>{this.actionStates[i]=t.movementX})),this.pointerLockYActions.forEach((i=>{this.actionStates[i]=t.movementY})))}}}class Z extends(U(X(I))){}class J extends(U(G)){constructor(){super(...arguments),this.keyToActions={KeyW:["MOVE_FORWARD"],KeyS:["MOVE_BACKWARD"],KeyA:["MOVE_LEFTWARD"],KeyD:["MOVE_RIGHTWARD"],Space:["JUMP"],ShiftLeft:["ACCELERATE"],ArrowUp:["ROTATE_UP"],ArrowDown:["ROTATE_DOWN"],ArrowRight:["ROTATE_RIGHT"],ArrowLeft:["ROTATE_LEFT"]}}}class Q extends(U(Y(G))){}class q extends(U(X(G))){}class $ extends p{constructor(i,e=16777215){super(new y(i.collider.radius,i.collider.length),new A({color:e,toneMapped:!1})),this.type="PhysicsControlsHelper",this._colliderPosition=new t,this.controls=i,this.matrixAutoUpdate=!1,this.frustumCulled=!1,this.update()}update(){this.geometry.dispose(),this.geometry=new y(this.controls.collider.radius,this.controls.collider.length),this.position.copy(this.controls.collider.getCenter(this._colliderPosition)),this.updateMatrix()}dispose(){this.geometry.dispose(),this.material.dispose()}}export{F as Collider,Y as DragMixin,N as FPKeyboardControls,H as FPKeyboardDragControls,Z as FPKeyboardPointerLockControls,I as FirstPersonControls,U as KeyboardMixin,z as PhysicsControls,$ as PhysicsControlsHelper,X as PointerLockMixin,J as TPKeyboardControls,Q as TPKeyboardDragControls,q as TPKeyboardPointerLockControls,G as ThirdPersonControls};
