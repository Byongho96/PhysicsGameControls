import{Vector3 as t,Plane as e,Line3 as i,Sphere as s,Box3 as o,Triangle as n,Layers as a,Controls as r,Ray as h,Quaternion as c,PerspectiveCamera as l,OrthographicCamera as d,Spherical as u,AnimationMixer as m,LoopOnce as p,LineSegments as _,CapsuleGeometry as y,LineBasicMaterial as A}from"three";function b(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function v(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,f(s.key),s)}}function T(t,e,i){return e&&v(t.prototype,e),i&&v(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function f(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}var g=function(){function e(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new t(0,0,0),s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new t(0,1,0),o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;b(this,e),this.start=i,this.end=s,this.radius=o}return T(e,[{key:"clone",value:function(){return new e(this.start.clone(),this.end.clone(),this.radius)}},{key:"set",value:function(t,e,i){this.start.copy(t),this.end.copy(e),this.radius=i}},{key:"copy",value:function(t){this.start.copy(t.start),this.end.copy(t.end),this.radius=t.radius}},{key:"getCenter",value:function(t){return t.copy(this.end).add(this.start).multiplyScalar(.5)}},{key:"translate",value:function(t){this.start.add(t),this.end.add(t)}},{key:"checkAABBAxis",value:function(t,e,i,s,o,n,a,r,h){return(o-t<h||o-i<h)&&(t-n<h||i-n<h)&&(a-e<h||a-s<h)&&(e-r<h||s-r<h)}},{key:"intersectsBox",value:function(t){return this.checkAABBAxis(this.start.x,this.start.y,this.end.x,this.end.y,t.min.x,t.max.x,t.min.y,t.max.y,this.radius)&&this.checkAABBAxis(this.start.x,this.start.z,this.end.x,this.end.z,t.min.x,t.max.x,t.min.z,t.max.z,this.radius)&&this.checkAABBAxis(this.start.y,this.start.z,this.end.y,this.end.z,t.min.y,t.max.y,t.min.z,t.max.z,this.radius)}}])}(),E=new t,O=new t,M=new t,w=new t,R=new e,x=new i,L=new i,D=new s,S=new g,W=new t,k=new t,P=new t;function V(t,e){var i,s,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=W.copy(t.end).sub(t.start),r=k.copy(e.end).sub(e.start),h=P.copy(e.start).sub(t.start),c=a.dot(r),l=a.dot(a),d=r.dot(r),u=r.dot(h),m=a.dot(h),p=l*d-c*c;if(Math.abs(p)<1e-10){var _=-u/d,y=(c-u)/d;Math.abs(_-.5)<Math.abs(y-.5)?(i=0,s=_):(i=1,s=y)}else s=((i=(u*c+m*d)/p)*c-u)/d;s=Math.max(0,Math.min(1,s)),i=Math.max(0,Math.min(1,i)),o&&o.copy(a).multiplyScalar(i).add(t.start),n&&n.copy(r).multiplyScalar(s).add(e.start)}var j=function(){function e(t){b(this,e),this.box=t,this.bounds=new o,this.subTrees=[],this.triangles=[],this.layers=new a}return T(e,[{key:"addTriangle",value:function(t){return this.bounds.min.x=Math.min(this.bounds.min.x,t.a.x,t.b.x,t.c.x),this.bounds.min.y=Math.min(this.bounds.min.y,t.a.y,t.b.y,t.c.y),this.bounds.min.z=Math.min(this.bounds.min.z,t.a.z,t.b.z,t.c.z),this.bounds.max.x=Math.max(this.bounds.max.x,t.a.x,t.b.x,t.c.x),this.bounds.max.y=Math.max(this.bounds.max.y,t.a.y,t.b.y,t.c.y),this.bounds.max.z=Math.max(this.bounds.max.z,t.a.z,t.b.z,t.c.z),this.triangles.push(t),this}},{key:"calcBox",value:function(){return this.box=this.bounds.clone(),this.box.min.x-=.01,this.box.min.y-=.01,this.box.min.z-=.01,this}},{key:"split",value:function(t){if(this.box){for(var i,s=[],n=O.copy(this.box.max).sub(this.box.min).multiplyScalar(.5),a=0;a<2;a++)for(var r=0;r<2;r++)for(var h=0;h<2;h++){var c=new o,l=E.set(a,r,h);c.min.copy(this.box.min).add(l.multiply(n)),c.max.copy(c.min).add(n),s.push(new e(c))}for(;i=this.triangles.pop();)for(var d=0;d<s.length;d++)s[d].box.intersectsTriangle(i)&&s[d].triangles.push(i);for(var u=0;u<s.length;u++){var m=s[u].triangles.length;m>8&&t<16&&s[u].split(t+1),0!==m&&this.subTrees.push(s[u])}return this}}},{key:"build",value:function(){return this.calcBox(),this.split(0),this}},{key:"getRayTriangles",value:function(t,e){for(var i=0;i<this.subTrees.length;i++){var s=this.subTrees[i];if(t.intersectsBox(s.box))if(s.triangles.length>0)for(var o=0;o<s.triangles.length;o++)-1===e.indexOf(s.triangles[o])&&e.push(s.triangles[o]);else s.getRayTriangles(t,e)}return e}},{key:"triangleCapsuleIntersect",value:function(t,e){e.getPlane(R);var i=R.distanceToPoint(t.start)-t.radius,s=R.distanceToPoint(t.end)-t.radius;if(i>0&&s>0||i<-t.radius&&s<-t.radius)return!1;var o=Math.abs(i/(Math.abs(i)+Math.abs(s))),n=E.copy(t.start).lerp(t.end,o);if(e.containsPoint(n))return{normal:R.normal.clone(),point:n.clone(),depth:Math.abs(Math.min(i,s))};for(var a=t.radius*t.radius,r=x.set(t.start,t.end),h=[[e.a,e.b],[e.b,e.c],[e.c,e.a]],c=0;c<h.length;c++){if(V(r,L.set(h[c][0],h[c][1]),M,w),M.distanceToSquared(w)<a)return{normal:M.clone().sub(w).normalize(),point:w.clone(),depth:t.radius-M.distanceTo(w)}}return!1}},{key:"triangleSphereIntersect",value:function(t,e){if(e.getPlane(R),!t.intersectsPlane(R))return!1;var i=Math.abs(R.distanceToSphere(t)),s=t.radius*t.radius-i*i,o=R.projectPoint(t.center,E);if(e.containsPoint(t.center))return{normal:R.normal.clone(),point:o.clone(),depth:Math.abs(R.distanceToSphere(t))};for(var n=[[e.a,e.b],[e.b,e.c],[e.c,e.a]],a=0;a<n.length;a++){x.set(n[a][0],n[a][1]),x.closestPointToPoint(o,!0,O);var r=O.distanceToSquared(t.center);if(r<s)return{normal:t.center.clone().sub(O).normalize(),point:O.clone(),depth:t.radius-Math.sqrt(r)}}return!1}},{key:"getSphereTriangles",value:function(t,e){for(var i=0;i<this.subTrees.length;i++){var s=this.subTrees[i];if(t.intersectsBox(s.box))if(s.triangles.length>0)for(var o=0;o<s.triangles.length;o++)-1===e.indexOf(s.triangles[o])&&e.push(s.triangles[o]);else s.getSphereTriangles(t,e)}}},{key:"getCapsuleTriangles",value:function(t,e){for(var i=0;i<this.subTrees.length;i++){var s=this.subTrees[i];if(t.intersectsBox(s.box))if(s.triangles.length>0)for(var o=0;o<s.triangles.length;o++)-1===e.indexOf(s.triangles[o])&&e.push(s.triangles[o]);else s.getCapsuleTriangles(t,e)}}},{key:"sphereIntersect",value:function(t){D.copy(t);var e,i=[],s=!1;this.getSphereTriangles(t,i);for(var o=0;o<i.length;o++)(e=this.triangleSphereIntersect(D,i[o]))&&(s=!0,D.center.add(e.normal.multiplyScalar(e.depth)));if(s){var n=D.center.clone().sub(t.center),a=n.length();return{normal:n.normalize(),depth:a}}return!1}},{key:"capsuleIntersect",value:function(e){S.copy(e);var i,s=[],o=!1;this.getCapsuleTriangles(S,s);for(var n=0;n<s.length;n++)(i=this.triangleCapsuleIntersect(S,s[n]))&&(o=!0,S.translate(i.normal.multiplyScalar(i.depth)));if(o){var a=S.getCenter(new t).sub(e.getCenter(E)),r=a.length();return{normal:a.normalize(),depth:r}}return!1}},{key:"rayIntersect",value:function(t){if(0!==t.direction.length()){var e,i,s=[],o=1e100;this.getRayTriangles(t,s);for(var n=0;n<s.length;n++){var a=t.intersectTriangle(s[n].a,s[n].b,s[n].c,!0,E);if(a){var r=a.sub(t.origin).length();o>r&&(i=a.clone().add(t.origin),o=r,e=s[n])}}return o<1e100&&{distance:o,triangle:e,position:i}}}},{key:"fromGraphNode",value:function(e){var i=this;return e.updateWorldMatrix(!0,!0),e.traverse((function(e){if(!0===e.isMesh&&i.layers.test(e.layers)){var s,o=!1;null!==e.geometry.index?(o=!0,s=e.geometry.toNonIndexed()):s=e.geometry;for(var a=s.getAttribute("position"),r=0;r<a.count;r+=3){var h=(new t).fromBufferAttribute(a,r),c=(new t).fromBufferAttribute(a,r+1),l=(new t).fromBufferAttribute(a,r+2);h.applyMatrix4(e.matrixWorld),c.applyMatrix4(e.matrixWorld),l.applyMatrix4(e.matrixWorld),i.addTriangle(new n(h,c,l))}o&&s.dispose()}})),this.build(),this}},{key:"clear",value:function(){return this.box=null,this.bounds.makeEmpty(),this.subTrees.length=0,this.triangles.length=0,this}}])}();class F extends g{constructor(e,i,s){super(e,i,s),this._center=new t}get length(){return this.start.distanceTo(this.end)}set length(t){const e=this.getCenter(this._center),i=this.end.clone().sub(this.start).normalize().multiplyScalar(t/2);this.start.copy(e).sub(i),this.end.copy(e).add(i)}}const C={type:"collide"};class B extends r{constructor(e,i=null,s=null){super(e,i),this.worldOctree=new j,this.gravity=30,this.maxFallSpeed=20,this.resistance=6,this.velocity=new t,this.step=5,this.landTimeThreshold=.3,this.landTolerance=.2,this.collider=new F,this.resetPoint=new t,this.minXBoundary=-1/0,this.maxXBoundary=1/0,this.minYBoundary=-1/0,this.maxYBoundary=1/0,this.minZBoundary=-1/0,this.maxZBoundary=1/0,this._isLanding=!1,this._isGrounded=!1,this._ray=new h(new t,new t(0,-1,0)),this._distance=new t,this._objectWorldPosition=new t,this._objectWorldQuaternion=new c,this._colliderLocalPosition=new t,this._world=s,s&&this.worldOctree.fromGraphNode(s)}get world(){return this._world}set world(t){this._world=t,t&&this.worldOctree.fromGraphNode(t)}get isLanding(){return this._isLanding}get isGrounded(){return this._isGrounded}getLocalVelocity(t){return this.object.getWorldQuaternion(this._objectWorldQuaternion),t.copy(this.velocity).applyQuaternion(this._objectWorldQuaternion.invert())}_checkCollisions(){this._isGrounded=!1;const t=this.worldOctree.capsuleIntersect(this.collider);t&&(t.normal.y>0&&(this._isGrounded=!0,this.velocity.y=0),t.depth>=1e-10&&(this.collider.translate(t.normal.multiplyScalar(t.depth)),this.dispatchEvent({...C,normal:t.normal.normalize()})))}_checkIsLanding(){if(this._isLanding=!1,this._isGrounded||this.velocity.y>=0)return;this._ray.origin.copy(this.collider.start).y-=this.collider.radius;const t=this.worldOctree.rayIntersect(this._ray),e=Math.min((this.maxFallSpeed+this.velocity.y)/this.gravity,this.landTimeThreshold),i=(-this.velocity.y+.5*this.gravity*e)*e,s=this.landTimeThreshold-e,o=this.maxFallSpeed*s;this.landTolerance<t.distance&&t.distance<i+o&&(this._isLanding=!0)}_teleportPlayerIfOutOfBounds(){const{x:t,y:e,z:i}=this.object.getWorldPosition(this._objectWorldPosition);(t<this.minXBoundary||t>this.maxXBoundary||e<this.minYBoundary||e>this.maxYBoundary||i<this.minZBoundary||i>this.maxZBoundary)&&(this.collider.translate(this._distance.subVectors(this.resetPoint,this._objectWorldPosition)),this.velocity.set(0,0,0))}update(t){if(super.update(t),!this.enabled)return;const e=t/this.step;for(let t=0;t<this.step;t++){let t=Math.exp(-this.resistance*e)-1;this._isGrounded||(this.velocity.y-=this.gravity*e,this.velocity.y=Math.max(this.velocity.y,-this.maxFallSpeed),t*=.1),this.velocity.x+=t*this.velocity.x,this.velocity.z+=t*this.velocity.z,this._distance.copy(this.velocity).multiplyScalar(e),this.collider.translate(this._distance),this._checkCollisions()}this._checkIsLanding(),this._teleportPlayerIfOutOfBounds(),this._colliderLocalPosition.copy(this.collider.start),this._colliderLocalPosition.y-=this.collider.radius,this.object.parent&&this.object.parent.worldToLocal(this._colliderLocalPosition),this.object.position.copy(this._colliderLocalPosition)}}const z=new t(0,1,0);class I extends B{constructor(e,i=null,s=null){super(e,i,s),this.actionStates={MOVE_FORWARD:0,MOVE_BACKWARD:0,MOVE_LEFTWARD:0,MOVE_RIGHTWARD:0,JUMP:0,ACCELERATE:0,ROTATE_UP:0,ROTATE_DOWN:0,ROTATE_RIGHT:0,ROTATE_LEFT:0},this.eyeHeight=1.6,this.jumpForce=15,this.groundedMoveSpeed=30,this.floatingMoveSpeed=8,this.rotateSpeed=1,this.enableAcceleration=!0,this.accelerationFactor=1.5,this.enableZoom=!0,this.zoomSpeed=1,this._movementVector=new t,this._objectLocalVector=new t,this._bindOnMouseWheel=this._onMouseWheel.bind(this),this.object.rotation.order="YZX",this.collider.radius=this.eyeHeight/4,this.collider.length=this.eyeHeight/2,this.connect()}getForwardVector(t){return this.object.getWorldDirection(t),t.y=0,t.normalize(),t}getRightwardVector(t){return this.object.getWorldDirection(t),t.y=0,t.cross(z),t.normalize(),t}_updateMovement(t){let e=t*(this.isGrounded?this.groundedMoveSpeed:this.floatingMoveSpeed);this.enableAcceleration&&this.actionStates.ACCELERATE&&(e*=this.accelerationFactor),this._movementVector.set(0,0,0),this.actionStates.MOVE_FORWARD&&this._movementVector.add(this.getForwardVector(this._objectLocalVector).multiplyScalar(this.actionStates.MOVE_FORWARD*e)),this.actionStates.MOVE_BACKWARD&&this._movementVector.sub(this.getForwardVector(this._objectLocalVector).multiplyScalar(this.actionStates.MOVE_BACKWARD*e)),this.actionStates.MOVE_RIGHTWARD&&this._movementVector.add(this.getRightwardVector(this._objectLocalVector).multiplyScalar(this.actionStates.MOVE_RIGHTWARD*e)),this.actionStates.MOVE_LEFTWARD&&this._movementVector.sub(this.getRightwardVector(this._objectLocalVector).multiplyScalar(this.actionStates.MOVE_LEFTWARD*e)),this.actionStates.JUMP&&this.isGrounded&&this._movementVector.addScaledVector(z,this.jumpForce),this.velocity.add(this._movementVector)}_updateRotation(t){const e=this.rotateSpeed*t/5;this.actionStates.ROTATE_UP&&this.object.rotateX(this.actionStates.ROTATE_UP*e),this.actionStates.ROTATE_DOWN&&this.object.rotateX(-this.actionStates.ROTATE_DOWN*e),this.actionStates.ROTATE_RIGHT&&this.object.rotateOnWorldAxis(z,-this.actionStates.ROTATE_RIGHT*e),this.actionStates.ROTATE_LEFT&&this.object.rotateOnWorldAxis(z,this.actionStates.ROTATE_LEFT*e),this.object.rotation.x=Math.max(-Math.PI/2,Math.min(Math.PI/2,this.object.rotation.x))}update(t){super.update(t),this.object.position.y+=this.eyeHeight,this._updateMovement(t),this._updateRotation(t)}connect(){var t;super.connect(),null===(t=this.domElement)||void 0===t||t.addEventListener("wheel",this._bindOnMouseWheel)}disconnect(){var t;super.disconnect(),null===(t=this.domElement)||void 0===t||t.removeEventListener("wheel",this._bindOnMouseWheel)}_onMouseWheel(t){if(!this.enableZoom)return;if(!(this.object instanceof l||this.object instanceof d))return console.warn("WARNING: FirstPersonControls.js encountered an unknown camera type - dolly/zoom disabled."),void(this.enableZoom=!1);const e=Math.pow(.95,this.zoomSpeed*Math.abs(.01*t.deltaY));t.deltaY>0?this.object.zoom*=e:t.deltaY<0&&(this.object.zoom/=e),this.object.updateProjectionMatrix()}}const K=new t(0,1,0);class U extends I{constructor(e,i=null,s=null,n={},a=null){super(e,i,s),this._animationClips={},this._animationActions={},this.eyeHeight=0,this.transitionTime=.3,this.transitionDelay=.3,this.fallSpeedThreshold=15,this.moveSpeedThreshold=1,this.runSpeedThreshold=10,this.cameraLerpFactor=.2,this.enableRotationOnMove=!0,this.syncAxisWithCamera="MOVE",this._spherical=new u,this._forwardDirection=new t,this._objectLocalVelocity=new t,this._objectLookAtPosition=new t,this._movementDirection=new t,this._currentActionKey=null,this._cameraLookAtPosition=new t,this._cameraOffsetPosition=new t,this._animationMixer=new m(this.object),Object.entries(n).forEach((([t,e])=>{this.setAnimationClip(t,e)})),this.camera=a;const r=new t;(new o).setFromObject(this.object).getSize(r),this.cameraPositionOffset=new t(0,1.5*r.y,1.5*-r.y),this.cameraLookAtOffset=new t(0,.8*r.y,0);const h=this.cameraPositionOffset.clone().sub(this.cameraLookAtOffset);this._spherical.setFromVector3(h),this.collider.radius=r.y/4,this.collider.length=r.y/2}get animationClips(){return Object.freeze({...this._animationClips})}getForwardVector(t){return t.copy(this._forwardDirection),t}getRightwardVector(t){return t.copy(this._forwardDirection),t.cross(K),t}setAnimationClip(t,e){const i=this._animationMixer.clipAction(e);this._animationClips[t]=e,this._animationActions[t]=i}deleteAnimationClip(t){const e=this._animationClips[t],i=this._animationActions[t];i&&(i.stop(),this._animationMixer.uncacheAction(e,this.object),delete this._animationActions[t]),e&&(this._animationMixer.uncacheClip(e),delete this._animationClips[t])}getAnimationAction(t){return this._animationActions[t]}_fadeToAction(t,e,i){if(t===this._currentActionKey)return;const s=this._animationActions[t];if(!s)return;const o=this._currentActionKey?this._animationActions[this._currentActionKey]:null;o&&o.fadeOut(e),s.reset(),i&&(s.setLoop(p,1),s.clampWhenFinished=!0),s.fadeIn(e),s.play(),this._currentActionKey=t}_syncForwardDirection(){if(this.camera&&"NEVER"!==this.syncAxisWithCamera)return"ALWAYS"===this.syncAxisWithCamera||this.actionStates.MOVE_FORWARD||this.actionStates.MOVE_BACKWARD||this.actionStates.MOVE_LEFTWARD||this.actionStates.MOVE_RIGHTWARD?(this.camera.getWorldDirection(this._forwardDirection),this._forwardDirection.y=0,void this._forwardDirection.normalize()):void 0}_updateObjectDirection(){return this._movementDirection.copy(this.velocity),this._movementDirection.y=0,this.object.getWorldPosition(this._objectLookAtPosition),this._movementDirection.length()>.01&&this.enableRotationOnMove?(this._objectLookAtPosition.add(this._movementDirection),void this.object.lookAt(this._objectLookAtPosition)):"ALWAYS"===this.syncAxisWithCamera||this._movementDirection.length()>.01?(this._objectLookAtPosition.add(this._forwardDirection),void this.object.lookAt(this._objectLookAtPosition)):void 0}_lerpCameraPosition(){this.camera&&(this._spherical.radius=this.cameraPositionOffset.distanceTo(this.cameraLookAtOffset),this.object.getWorldPosition(this._cameraLookAtPosition).add(this.cameraLookAtOffset),this._cameraOffsetPosition.setFromSpherical(this._spherical).add(this._cameraLookAtPosition),this.camera.position.lerp(this._cameraOffsetPosition,this.cameraLerpFactor),this.camera.lookAt(this._cameraLookAtPosition),this.camera.updateMatrixWorld())}_updateAnimation(){return this.getLocalVelocity(this._objectLocalVelocity),this._objectLocalVelocity.y>0&&this._animationActions.JUMP_UP?this._fadeToAction("JUMP_UP",this.transitionTime,!0):this.isLanding&&this._animationActions.LAND?this._fadeToAction("LAND",this.transitionTime,!0):this.velocity.y<-this.fallSpeedThreshold&&"LAND"!==this._currentActionKey&&this._animationActions.FALL?this._fadeToAction("FALL",this.transitionTime):this.isGrounded?this._objectLocalVelocity.z>this.runSpeedThreshold&&this._animationActions.RUN_FORWARD?this._fadeToAction("RUN_FORWARD",this.transitionTime):this._objectLocalVelocity.z>this.moveSpeedThreshold&&this._animationActions.MOVE_FORWARD?this._fadeToAction("MOVE_FORWARD",this.transitionTime):this._objectLocalVelocity.z<-this.runSpeedThreshold&&this._animationActions.RUN_BACKWARD?this._fadeToAction("RUN_BACKWARD",this.transitionTime):this._objectLocalVelocity.z<-this.moveSpeedThreshold&&this._animationActions.MOVE_BACKWARD?this._fadeToAction("MOVE_BACKWARD",this.transitionTime):this._objectLocalVelocity.x<-this.runSpeedThreshold&&this._animationActions.RUN_RIGHTWARD?this._fadeToAction("RUN_RIGHTWARD",this.transitionTime):this._objectLocalVelocity.x<-this.moveSpeedThreshold&&this._animationActions.MOVE_RIGHTWARD?this._fadeToAction("MOVE_RIGHTWARD",this.transitionTime):this._objectLocalVelocity.x>this.runSpeedThreshold&&this._animationActions.RUN_LEFTWARD?this._fadeToAction("RUN_LEFTWARD",this.transitionTime):this._objectLocalVelocity.x>this.moveSpeedThreshold&&this._animationActions.MOVE_LEFTWARD?this._fadeToAction("MOVE_LEFTWARD",this.transitionTime):this._fadeToAction("IDLE",this.transitionTime):void 0}_updateRotation(t){const e=this.rotateSpeed*t;this.actionStates.ROTATE_UP&&(this._spherical.phi+=this.actionStates.ROTATE_UP*e),this.actionStates.ROTATE_DOWN&&(this._spherical.phi-=this.actionStates.ROTATE_DOWN*e),this.actionStates.ROTATE_RIGHT&&(this._spherical.theta-=this.actionStates.ROTATE_RIGHT*e),this.actionStates.ROTATE_LEFT&&(this._spherical.theta+=this.actionStates.ROTATE_LEFT*e),this._spherical.makeSafe()}update(t){super.update(t),this._updateAnimation(),this._animationMixer.update(t),this._syncForwardDirection(),this._updateObjectDirection(),this._lerpCameraPosition()}dispose(){super.dispose(),this._animationMixer.stopAllAction(),this._animationMixer.uncacheRoot(this.object)}_onMouseWheel(t){if(!this.enableZoom)return;if(!(this.camera instanceof l||this.camera instanceof d))return console.warn("WARNING: FirstPersonControls.js encountered an unknown camera type - dolly/zoom disabled."),void(this.enableZoom=!1);const e=Math.pow(.95,this.zoomSpeed*Math.abs(.01*t.deltaY));t.deltaY>0?this.camera.zoom*=e:t.deltaY<0&&(this.camera.zoom/=e),this.camera.updateProjectionMatrix()}}function G(t){return class extends t{constructor(...t){super(...t),this.keyToActions={KeyW:["MOVE_FORWARD"],KeyS:["MOVE_BACKWARD"],KeyA:["MOVE_LEFTWARD"],KeyD:["MOVE_RIGHTWARD"],Space:["JUMP"],ShiftLeft:["ACCELERATE"]},this._bindOnKeyDown=this._onKeyDown.bind(this),this._bindOnKeyUp=this._onKeyUp.bind(this),this._bindOnBlur=this._onBlur.bind(this),this.connect()}connect(){super.connect(),window.addEventListener("keydown",this._bindOnKeyDown),window.addEventListener("keyup",this._bindOnKeyUp),window.addEventListener("blur",this._bindOnBlur)}disconnect(){super.disconnect(),window.removeEventListener("keydown",this._bindOnKeyDown),window.removeEventListener("keyup",this._bindOnKeyUp),window.removeEventListener("blur",this._bindOnBlur)}dispose(){super.dispose(),this.disconnect()}_onKeyDown(t){t.code in this.keyToActions&&this.keyToActions[t.code].forEach((t=>{this.actionStates[t]=1}))}_onKeyUp(t){t.code in this.keyToActions&&this.keyToActions[t.code].forEach((t=>{this.actionStates[t]=0}))}_onBlur(){Object.keys(this.keyToActions).forEach((t=>{this.keyToActions[t].forEach((t=>{this.actionStates[t]=0}))}))}}}class N extends(G(I)){constructor(){super(...arguments),this.keyToActions={KeyW:["MOVE_FORWARD"],KeyS:["MOVE_BACKWARD"],KeyA:["MOVE_LEFTWARD"],KeyD:["MOVE_RIGHTWARD"],Space:["JUMP"],ShiftLeft:["ACCELERATE"],ArrowUp:["ROTATE_UP"],ArrowDown:["ROTATE_DOWN"],ArrowRight:["ROTATE_RIGHT"],ArrowLeft:["ROTATE_LEFT"]}}}function H(t){return class extends t{constructor(...t){super(...t),this.dragXActions=["ROTATE_RIGHT"],this.dragYActions=["ROTATE_DOWN"],this.dragDampingFactor=1,this.enableDragDamping=!0,this._isMouseDown=!1,this._bindOnMouseDown=this._onMouseDown.bind(this),this._bindOnMouseUp=this._onMouseUp.bind(this),this._bindOnMouseMove=this._onMouseMove.bind(this),this.connect()}connect(){var t,e;super.connect(),null===(t=this.domElement)||void 0===t||t.addEventListener("mousedown",this._bindOnMouseDown),document.addEventListener("mouseup",this._bindOnMouseUp),null===(e=this.domElement)||void 0===e||e.addEventListener("mousemove",this._bindOnMouseMove)}disconnect(){var t,e;super.disconnect(),null===(t=this.domElement)||void 0===t||t.removeEventListener("mousedown",this._bindOnMouseDown),document.removeEventListener("mouseup",this._bindOnMouseUp),null===(e=this.domElement)||void 0===e||e.removeEventListener("mousemove",this._bindOnMouseMove)}dispose(){super.dispose(),this.disconnect()}update(t){super.update(t),this.enableDragDamping&&(this.dragXActions.forEach((t=>{this.actionStates[t]*=1-this.dragDampingFactor})),this.dragYActions.forEach((t=>{this.actionStates[t]*=1-this.dragDampingFactor})))}_onMouseDown(){this._isMouseDown=!0}_onMouseUp(){this._isMouseDown=!1}_onMouseMove(t){this._isMouseDown&&(this.dragXActions.forEach((e=>{this.actionStates[e]=t.movementX})),this.dragYActions.forEach((e=>{this.actionStates[e]=t.movementY})))}}}class Y extends(G(H(I))){}function X(t){return class extends t{constructor(...t){super(...t),this.pointerLockXActions=["ROTATE_RIGHT"],this.pointerLockYActions=["ROTATE_DOWN"],this.pointerLockDampingFactor=1,this.enablePointerLockDamping=!0,this._bindOnMouseDown=this._onMouseDown.bind(this),this._bindOnMouseMove=this._onMouseMove.bind(this),this.connect()}connect(){var t,e;super.connect(),null===(t=this.domElement)||void 0===t||t.addEventListener("mousedown",this._bindOnMouseDown),null===(e=this.domElement)||void 0===e||e.addEventListener("mousemove",this._bindOnMouseMove)}disconnect(){var t,e;super.disconnect(),null===(t=this.domElement)||void 0===t||t.removeEventListener("mousedown",this._bindOnMouseDown),null===(e=this.domElement)||void 0===e||e.removeEventListener("mousemove",this._bindOnMouseMove)}dispose(){super.dispose(),this.disconnect()}update(t){super.update(t),this.enablePointerLockDamping&&(this.pointerLockXActions.forEach((t=>{this.actionStates[t]*=1-this.pointerLockDampingFactor})),this.pointerLockYActions.forEach((t=>{this.actionStates[t]*=1-this.pointerLockDampingFactor})))}_onMouseDown(){var t;null===(t=this.domElement)||void 0===t||t.requestPointerLock()}_onMouseMove(t){document.pointerLockElement===this.domElement&&(this.pointerLockXActions.forEach((e=>{this.actionStates[e]=t.movementX})),this.pointerLockYActions.forEach((e=>{this.actionStates[e]=t.movementY})))}}}class Z extends(G(X(I))){}class J extends(G(U)){constructor(){super(...arguments),this.keyToActions={KeyW:["MOVE_FORWARD"],KeyS:["MOVE_BACKWARD"],KeyA:["MOVE_LEFTWARD"],KeyD:["MOVE_RIGHTWARD"],Space:["JUMP"],ShiftLeft:["ACCELERATE"],ArrowUp:["ROTATE_UP"],ArrowDown:["ROTATE_DOWN"],ArrowRight:["ROTATE_RIGHT"],ArrowLeft:["ROTATE_LEFT"]}}}class Q extends(G(H(U))){}class q extends(G(X(U))){}class $ extends _{constructor(e,i=16777215){super(new y(e.collider.radius,e.collider.length),new A({color:i,toneMapped:!1})),this.type="PhysicsControlsHelper",this._colliderPosition=new t,this.controls=e,this.matrixAutoUpdate=!1,this.frustumCulled=!1,this.update()}update(){this.geometry.dispose(),this.geometry=new y(this.controls.collider.radius,this.controls.collider.length),this.position.copy(this.controls.collider.getCenter(this._colliderPosition)),this.updateMatrix()}dispose(){this.geometry.dispose(),this.material.dispose()}}export{N as FPKeyboardControls,Y as FPKeyboardDragControls,Z as FPKeyboardPointerLockControls,I as FirstPersonControls,B as PhysicsControls,$ as PhysicsControlsHelper,J as TPKeyboardControls,Q as TPKeyboardDragControls,q as TPKeyboardPointerLockControls,U as ThirdPersonControls};
