import{Vector3 as t,Line3 as i,Plane as e,Box3 as s,Layers as o,Mesh as n,Triangle as a,Controls as r,Ray as h,Quaternion as c,PerspectiveCamera as l,OrthographicCamera as d,Spherical as m,AnimationMixer as u,LoopOnce as _,LineSegments as p,CapsuleGeometry as y,LineBasicMaterial as A}from"three";function g(t,i){for(var e=0;e<i.length;e++){var s=i[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,b(s.key),s)}}function b(t){var i=function(t,i){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var s=e.call(t,i||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===i?String:Number)(t)}(t,"string");return"symbol"==typeof i?i:i+""}var v=function(){function i(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new t(0,0,0),s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new t(0,1,0),o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,i),this.start=e,this.end=s,this.radius=o}return e=i,(s=[{key:"clone",value:function(){return new i(this.start.clone(),this.end.clone(),this.radius)}},{key:"set",value:function(t,i,e){this.start.copy(t),this.end.copy(i),this.radius=e}},{key:"copy",value:function(t){this.start.copy(t.start),this.end.copy(t.end),this.radius=t.radius}},{key:"getCenter",value:function(t){return t.copy(this.end).add(this.start).multiplyScalar(.5)}},{key:"translate",value:function(t){this.start.add(t),this.end.add(t)}},{key:"checkAABBAxis",value:function(t,i,e,s,o,n,a,r,h){return(o-t<h||o-e<h)&&(t-n<h||e-n<h)&&(a-i<h||a-s<h)&&(i-r<h||s-r<h)}},{key:"intersectsBox",value:function(t){return this.checkAABBAxis(this.start.x,this.start.y,this.end.x,this.end.y,t.min.x,t.max.x,t.min.y,t.max.y,this.radius)&&this.checkAABBAxis(this.start.x,this.start.z,this.end.x,this.end.z,t.min.x,t.max.x,t.min.z,t.max.z,this.radius)&&this.checkAABBAxis(this.start.y,this.start.z,this.end.y,this.end.z,t.min.y,t.max.y,t.min.z,t.max.z,this.radius)}}])&&g(e.prototype,s),o&&g(e,o),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,s,o}();const T=new t,E=new t,f=new t;function x(t,i,e=null,s=null){const o=T.copy(t.end).sub(t.start),n=E.copy(i.end).sub(i.start),a=f.copy(i.start).sub(t.start),r=o.dot(n),h=o.dot(o),c=n.dot(n),l=n.dot(a),d=o.dot(a);let m,u;const _=h*c-r*r;if(Math.abs(_)<1e-10){const t=-l/c,i=(r-l)/c;Math.abs(t-.5)<Math.abs(i-.5)?(m=0,u=t):(m=1,u=i)}else m=(l*r+d*c)/_,u=(m*r-l)/c;u=Math.max(0,Math.min(1,u)),m=Math.max(0,Math.min(1,m)),e&&e.copy(o).multiplyScalar(m).add(t.start),s&&s.copy(n).multiplyScalar(u).add(i.start)}const O=new t,D=new t,w=new t,M=new i,R=new i,L=new e;function V(t,i){i.getPlane(L);const e=L.distanceToPoint(t.start)-t.radius,s=L.distanceToPoint(t.end)-t.radius;if(e>0&&s>0||e<-t.radius&&s<-t.radius)return!1;const o=Math.abs(e/(Math.abs(e)+Math.abs(s))),n=O.copy(t.start).lerp(t.end,o);if(i.containsPoint(n))return{normal:L.normal.clone(),point:n.clone(),depth:Math.abs(Math.min(e,s))};const a=t.radius*t.radius,r=M.set(t.start,t.end),h=[[i.a,i.b],[i.b,i.c],[i.c,i.a]];for(let i=0;i<h.length;i++){if(x(r,R.set(h[i][0],h[i][1]),D,w),D.distanceToSquared(w)<a)return{normal:D.clone().sub(w).normalize(),point:w.clone(),depth:t.radius-D.distanceTo(w)}}return!1}const S=new t,W=new v;class P{constructor(t){this.bounds=new s,this.depth=48,this.duplicationThreshold=.01,this.layers=new o,this.minVolume=null,this.maxVolume=null,this.triangles=[],this.box=t||new s}addTriangle(t){this.bounds.min.x=Math.min(this.bounds.min.x,t.a.x,t.b.x,t.c.x),this.bounds.min.y=Math.min(this.bounds.min.y,t.a.y,t.b.y,t.c.y),this.bounds.min.z=Math.min(this.bounds.min.z,t.a.z,t.b.z,t.c.z),this.bounds.max.x=Math.max(this.bounds.max.x,t.a.x,t.b.x,t.c.x),this.bounds.max.y=Math.max(this.bounds.max.y,t.a.y,t.b.y,t.c.y),this.bounds.max.z=Math.max(this.bounds.max.z,t.a.z,t.b.z,t.c.z),this.triangles.push(t)}calcBox(){this.box.copy(this.bounds),this.box.min.x-=.01,this.box.min.y-=.01,this.box.min.z-=.01}optimizeBox(){this.box.min.x=Math.max(this.box.min.x,this.bounds.min.x),this.box.min.y=Math.max(this.box.min.y,this.bounds.min.y),this.box.min.z=Math.max(this.box.min.z,this.bounds.min.z),this.box.max.x=Math.min(this.box.max.x,this.bounds.max.x),this.box.max.y=Math.min(this.box.max.y,this.bounds.max.y),this.box.max.z=Math.min(this.box.max.z,this.bounds.max.z)}split(t){this.optimizeBox();const i=this.box.getSize(S);let e="x";i.y>i.x&&i.y>i.z?e="y":i.z>i.x&&i.z>i.y&&(e="z");const s=this.box.getCenter(S)[e],o=new P(this.box.clone());o.depth=this.depth,o.duplicationThreshold=this.duplicationThreshold,o.box.max[e]=s;const n=new P(this.box.clone());n.depth=this.depth,n.duplicationThreshold=this.duplicationThreshold,n.box.min[e]=s;let a=this.triangles.pop();for(;a;){if(a.getArea()>this.duplicationThreshold)o.box.intersectsTriangle(a)&&o.addTriangle(a),n.box.intersectsTriangle(a)&&n.addTriangle(a);else{a.getMidpoint(S)[e]<s?o.addTriangle(a):n.addTriangle(a)}a=this.triangles.pop()}o.triangles.length>0&&(this.minVolume=o),n.triangles.length>0&&(this.maxVolume=n),o.triangles.length>8&&t<this.depth&&o.split(t+1),n.triangles.length>8&&t<this.depth&&n.split(t+1)}build(){this.calcBox(),this.split(0)}buildFromObject(i){i.updateWorldMatrix(!0,!0),i.traverse((i=>{if(i instanceof n&&this.layers.test(i.layers)){let e=null,s=!1;null!==i.geometry.index?(s=!0,e=i.geometry.toNonIndexed()):e=i.geometry;const o=e.getAttribute("position");for(let e=0;e<o.count;e+=3){const s=(new t).fromBufferAttribute(o,e),n=(new t).fromBufferAttribute(o,e+1),r=(new t).fromBufferAttribute(o,e+2);s.applyMatrix4(i.matrixWorld),n.applyMatrix4(i.matrixWorld),r.applyMatrix4(i.matrixWorld),this.addTriangle(new a(s,n,r))}s&&e.dispose()}})),this.build()}_getRayTriangles(t,i){if(this.minVolume&&t.intersectsBox(this.minVolume.box))if(this.minVolume.triangles.length>0)for(let t=0;t<this.minVolume.triangles.length;t++)-1===i.indexOf(this.minVolume.triangles[t])&&i.push(this.minVolume.triangles[t]);else this.minVolume._getRayTriangles(t,i);if(this.maxVolume&&t.intersectsBox(this.maxVolume.box))if(this.maxVolume.triangles.length>0)for(let t=0;t<this.maxVolume.triangles.length;t++)-1===i.indexOf(this.maxVolume.triangles[t])&&i.push(this.maxVolume.triangles[t]);else this.maxVolume._getRayTriangles(t,i)}_getCapsuleTriangles(t,i){if(this.minVolume&&t.intersectsBox(this.minVolume.box))if(this.minVolume.triangles.length>0)for(let t=0;t<this.minVolume.triangles.length;t++)-1===i.indexOf(this.minVolume.triangles[t])&&i.push(this.minVolume.triangles[t]);else this.minVolume._getCapsuleTriangles(t,i);if(this.maxVolume&&t.intersectsBox(this.maxVolume.box))if(this.maxVolume.triangles.length>0)for(let t=0;t<this.maxVolume.triangles.length;t++)-1===i.indexOf(this.maxVolume.triangles[t])&&i.push(this.maxVolume.triangles[t]);else this.maxVolume._getCapsuleTriangles(t,i)}rayIntersect(t){if(0===t.direction.length())return!1;const i=[];let e,s;this._getRayTriangles(t,i);let o=1e100;for(let n=0;n<i.length;n++){const a=t.intersectTriangle(i[n].a,i[n].b,i[n].c,!0,S);if(a){const r=a.sub(t.origin).length();o>r&&(s=a.clone().add(t.origin),o=r,e=i[n])}}return o<1e100&&{distance:o,triangle:e,position:s}}capsuleIntersect(i){W.copy(i);const e=[];this._getCapsuleTriangles(W,e);let s=!1;for(let t=0;t<e.length;t++){const i=V(W,e[t]);i&&(s=!0,W.translate(i.normal.multiplyScalar(i.depth)))}if(s){const e=W.getCenter(new t).sub(i.getCenter(S)),s=e.length();return{normal:e.normalize(),depth:s}}return!1}clear(){return this.box.makeEmpty(),this.bounds.makeEmpty(),this.minVolume=null,this.maxVolume=null,this.triangles=[],this}}class j extends v{constructor(i,e,s){super(i,e,s),this._center=new t}get length(){return this.start.distanceTo(this.end)}set length(t){const i=this.getCenter(this._center),e=this.end.clone().sub(this.start).normalize().multiplyScalar(t/2);this.start.copy(i).sub(e),this.end.copy(i).add(e)}}const k={type:"collide"};class z extends r{constructor(i,e=null,s=null){super(i,e),this._world=null,this.worldBVH=new P,this.gravity=30,this.maxFallSpeed=20,this.resistance=6,this.velocity=new t,this.step=5,this.landTimeThreshold=.3,this.landTolerance=.6,this.collider=new j,this.resetPoint=new t,this.minXBoundary=-1/0,this.maxXBoundary=1/0,this.minYBoundary=-1/0,this.maxYBoundary=1/0,this.minZBoundary=-1/0,this.maxZBoundary=1/0,this._isLanding=!1,this._isGrounded=!1,this._ray=new h(new t,new t(0,-1,0)),this._distance=new t,this._objectWorldPosition=new t,this._objectWorldQuaternion=new c,this._colliderLocalPosition=new t,this.world=s}get world(){return this._world}set world(t){this._world=t,t&&(this.worldBVH.clear(),this.worldBVH.buildFromObject(t))}get isLanding(){return this._isLanding}get isGrounded(){return this._isGrounded}getLocalVelocity(t){return this.object.getWorldQuaternion(this._objectWorldQuaternion),t.copy(this.velocity).applyQuaternion(this._objectWorldQuaternion.invert())}_checkCollisions(){this._isGrounded=!1;const t=this.worldBVH.capsuleIntersect(this.collider);t&&(t.normal.y>0&&(this._isGrounded=!0,this.velocity.y=0),t.depth>=1e-10&&(this.collider.translate(t.normal.multiplyScalar(1.01*t.depth)),this.dispatchEvent({...k,normal:t.normal.normalize()})))}_checkIsLanding(){if(this._isLanding=!1,this._isGrounded||this.velocity.y>=0)return;this._ray.origin.copy(this.collider.start).y-=this.collider.radius;const t=this.worldBVH.rayIntersect(this._ray);if(!t)return;const i=Math.min((this.maxFallSpeed+this.velocity.y)/this.gravity,this.landTimeThreshold),e=(-this.velocity.y+.5*this.gravity*i)*i,s=this.landTimeThreshold-i,o=this.maxFallSpeed*s;this.landTolerance<t.distance&&t.distance<e+o&&(this._isLanding=!0)}_teleportPlayerIfOutOfBounds(){const{x:t,y:i,z:e}=this.object.getWorldPosition(this._objectWorldPosition);(t<this.minXBoundary||t>this.maxXBoundary||i<this.minYBoundary||i>this.maxYBoundary||e<this.minZBoundary||e>this.maxZBoundary)&&(this.collider.translate(this._distance.subVectors(this.resetPoint,this._objectWorldPosition)),this.velocity.set(0,0,0))}update(t){if(super.update(t),!this.enabled)return;const i=t/this.step;for(let t=0;t<this.step;t++){let t=Math.exp(-this.resistance*i)-1;this._isGrounded||(this.velocity.y-=this.gravity*i,this.velocity.y=Math.max(this.velocity.y,-this.maxFallSpeed),t*=.1),this.velocity.x+=t*this.velocity.x,this.velocity.z+=t*this.velocity.z,this._distance.copy(this.velocity).multiplyScalar(i),this.collider.translate(this._distance),this._checkCollisions()}this._checkIsLanding(),this._teleportPlayerIfOutOfBounds(),this._colliderLocalPosition.copy(this.collider.start),this._colliderLocalPosition.y-=this.collider.radius,this.object.parent&&this.object.parent.worldToLocal(this._colliderLocalPosition),this.object.position.copy(this._colliderLocalPosition)}dispose(){super.dispose(),this.worldBVH.clear()}}const F=new t(0,1,0);class B extends z{constructor(i,e=null,s=null){super(i,e,s),this.actionStates={MOVE_FORWARD:0,MOVE_BACKWARD:0,MOVE_LEFTWARD:0,MOVE_RIGHTWARD:0,JUMP:0,ACCELERATE:0,ROTATE_UP:0,ROTATE_DOWN:0,ROTATE_RIGHT:0,ROTATE_LEFT:0},this.eyeHeight=1.6,this.jumpForce=15,this.groundedMoveSpeed=30,this.floatingMoveSpeed=8,this.rotateSpeed=1,this.maxTiltAngle=Math.PI/2,this.minTiltAngle=-Math.PI/2,this.enableAcceleration=!0,this.accelerationFactor=1.5,this.enableZoom=!0,this.zoomSpeed=1,this.minZoom=0,this.maxZoom=1/0,this._movementVector=new t,this._objectLocalVector=new t,this._bindOnMouseWheel=this._onMouseWheel.bind(this),this.object.rotation.order="YZX",this.collider.radius=this.eyeHeight/4,this.collider.length=this.eyeHeight/2,this.connect()}getForwardVector(t){return this.object.getWorldDirection(t),t.y=0,t.normalize(),t}getRightwardVector(t){return this.object.getWorldDirection(t),t.y=0,t.cross(F),t.normalize(),t}_updateMovement(t){let i=t*(this.isGrounded?this.groundedMoveSpeed:this.floatingMoveSpeed);this.enableAcceleration&&this.actionStates.ACCELERATE&&(i*=this.accelerationFactor),this._movementVector.set(0,0,0),this.actionStates.MOVE_FORWARD&&this._movementVector.add(this.getForwardVector(this._objectLocalVector).multiplyScalar(this.actionStates.MOVE_FORWARD*i)),this.actionStates.MOVE_BACKWARD&&this._movementVector.sub(this.getForwardVector(this._objectLocalVector).multiplyScalar(this.actionStates.MOVE_BACKWARD*i)),this.actionStates.MOVE_RIGHTWARD&&this._movementVector.add(this.getRightwardVector(this._objectLocalVector).multiplyScalar(this.actionStates.MOVE_RIGHTWARD*i)),this.actionStates.MOVE_LEFTWARD&&this._movementVector.sub(this.getRightwardVector(this._objectLocalVector).multiplyScalar(this.actionStates.MOVE_LEFTWARD*i)),this.actionStates.JUMP&&this.isGrounded&&this._movementVector.addScaledVector(F,this.jumpForce),this.velocity.add(this._movementVector)}_updateRotation(t){const i=this.rotateSpeed*t/5;this.actionStates.ROTATE_UP&&this.object.rotateX(this.actionStates.ROTATE_UP*i),this.actionStates.ROTATE_DOWN&&this.object.rotateX(-this.actionStates.ROTATE_DOWN*i),this.actionStates.ROTATE_RIGHT&&this.object.rotateOnWorldAxis(F,-this.actionStates.ROTATE_RIGHT*i),this.actionStates.ROTATE_LEFT&&this.object.rotateOnWorldAxis(F,this.actionStates.ROTATE_LEFT*i),this.object.rotation.x=Math.max(this.minTiltAngle,Math.min(this.maxTiltAngle,this.object.rotation.x))}update(t){super.update(t),this.object.position.y+=this.eyeHeight,this._updateMovement(t),this._updateRotation(t)}connect(){var t;super.connect(),null===(t=this.domElement)||void 0===t||t.addEventListener("wheel",this._bindOnMouseWheel)}disconnect(){var t;super.disconnect(),null===(t=this.domElement)||void 0===t||t.removeEventListener("wheel",this._bindOnMouseWheel)}_onMouseWheel(t){if(!this.enableZoom)return;if(!(this.object instanceof l||this.object instanceof d))return console.warn("WARNING: FirstPersonControls.js encountered an unknown camera type - dolly/zoom disabled."),void(this.enableZoom=!1);const i=Math.pow(.95,this.zoomSpeed*Math.abs(.01*t.deltaY));t.deltaY>0?this.object.zoom*=i:t.deltaY<0&&(this.object.zoom/=i),this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom)),this.object.updateProjectionMatrix()}}const C=new t(0,1,0);class K extends B{constructor(i,e=null,o=null,n={},a=null){super(i,e,o),this._animationClips={},this._animationActions={},this.eyeHeight=0,this.transitionTime=.3,this.transitionDelay=.3,this.fallSpeedThreshold=15,this.moveSpeedThreshold=1,this.runSpeedThreshold=8,this.cameraLerpFactor=1,this.enableRotationOnMove=!0,this.syncAxisWithCamera="MOVE",this._spherical=new m,this._forwardDirection=new t,this._objectLocalVelocity=new t,this._objectLookAtPosition=new t,this._movementDirection=new t,this._currentActionKey=null,this._cameraLookAtPosition=new t,this._cameraOffsetPosition=new t,this._animationMixer=new u(this.object),Object.entries(n).forEach((([t,i])=>{this.setAnimationClip(t,i)})),this.camera=a;const r=new t;(new s).setFromObject(this.object).getSize(r),this.cameraPositionOffset=new t(0,1.5*r.y,1.5*-r.y),this.cameraLookAtOffset=new t(0,.8*r.y,0);const h=this.cameraPositionOffset.clone().sub(this.cameraLookAtOffset);this._spherical.setFromVector3(h),this.collider.radius=r.y/4,this.collider.length=r.y/2}get animationClips(){return Object.freeze({...this._animationClips})}getForwardVector(t){return t.copy(this._forwardDirection),t}getRightwardVector(t){return t.copy(this._forwardDirection),t.cross(C),t}setAnimationClip(t,i){const e=this._animationMixer.clipAction(i);this._animationClips[t]=i,this._animationActions[t]=e}deleteAnimationClip(t){const i=this._animationClips[t],e=this._animationActions[t];e&&(e.stop(),this._animationMixer.uncacheAction(i,this.object),delete this._animationActions[t]),i&&(this._animationMixer.uncacheClip(i),delete this._animationClips[t])}getAnimationAction(t){return this._animationActions[t]}_fadeToAction(t,i,e){if(t===this._currentActionKey)return;const s=this._animationActions[t];if(!s)return;const o=this._currentActionKey?this._animationActions[this._currentActionKey]:null;o&&o.fadeOut(i),s.reset(),e&&(s.setLoop(_,1),s.clampWhenFinished=!0),s.fadeIn(i),s.play(),this._currentActionKey=t}_syncForwardDirection(){if(this.camera&&"NEVER"!==this.syncAxisWithCamera)return"ALWAYS"===this.syncAxisWithCamera||this.actionStates.MOVE_FORWARD||this.actionStates.MOVE_BACKWARD||this.actionStates.MOVE_LEFTWARD||this.actionStates.MOVE_RIGHTWARD?(this.camera.getWorldDirection(this._forwardDirection),this._forwardDirection.y=0,void this._forwardDirection.normalize()):void 0}_updateObjectDirection(){return this._movementDirection.copy(this.velocity),this._movementDirection.y=0,this.object.getWorldPosition(this._objectLookAtPosition),this._movementDirection.length()>.01&&this.enableRotationOnMove?(this._objectLookAtPosition.add(this._movementDirection),void this.object.lookAt(this._objectLookAtPosition)):"ALWAYS"===this.syncAxisWithCamera||this._movementDirection.length()>.01?(this._objectLookAtPosition.add(this._forwardDirection),void this.object.lookAt(this._objectLookAtPosition)):void 0}_lerpCameraPosition(){this.camera&&(this._spherical.radius=this.cameraPositionOffset.distanceTo(this.cameraLookAtOffset),this.object.getWorldPosition(this._cameraLookAtPosition).add(this.cameraLookAtOffset),this._cameraOffsetPosition.setFromSpherical(this._spherical).add(this._cameraLookAtPosition),this.camera.position.lerp(this._cameraOffsetPosition,this.cameraLerpFactor),this.camera.lookAt(this._cameraLookAtPosition),this.camera.updateMatrixWorld())}_updateAnimation(){return this.getLocalVelocity(this._objectLocalVelocity),this._objectLocalVelocity.y>0&&this._animationActions.JUMP_UP?this._fadeToAction("JUMP_UP",this.transitionTime,!0):this.isLanding&&this._animationActions.LAND?this._fadeToAction("LAND",this.transitionTime,!0):this.velocity.y<-this.fallSpeedThreshold&&"LAND"!==this._currentActionKey&&this._animationActions.FALL?this._fadeToAction("FALL",this.transitionTime):this.isGrounded?this._objectLocalVelocity.z>this.runSpeedThreshold&&this._animationActions.RUN_FORWARD?this._fadeToAction("RUN_FORWARD",this.transitionTime):this._objectLocalVelocity.z>this.moveSpeedThreshold&&this._animationActions.MOVE_FORWARD?this._fadeToAction("MOVE_FORWARD",this.transitionTime):this._objectLocalVelocity.z<-this.runSpeedThreshold&&this._animationActions.RUN_BACKWARD?this._fadeToAction("RUN_BACKWARD",this.transitionTime):this._objectLocalVelocity.z<-this.moveSpeedThreshold&&this._animationActions.MOVE_BACKWARD?this._fadeToAction("MOVE_BACKWARD",this.transitionTime):this._objectLocalVelocity.x<-this.runSpeedThreshold&&this._animationActions.RUN_RIGHTWARD?this._fadeToAction("RUN_RIGHTWARD",this.transitionTime):this._objectLocalVelocity.x<-this.moveSpeedThreshold&&this._animationActions.MOVE_RIGHTWARD?this._fadeToAction("MOVE_RIGHTWARD",this.transitionTime):this._objectLocalVelocity.x>this.runSpeedThreshold&&this._animationActions.RUN_LEFTWARD?this._fadeToAction("RUN_LEFTWARD",this.transitionTime):this._objectLocalVelocity.x>this.moveSpeedThreshold&&this._animationActions.MOVE_LEFTWARD?this._fadeToAction("MOVE_LEFTWARD",this.transitionTime):this._fadeToAction("IDLE",this.transitionTime):void 0}_updateRotation(t){const i=this.rotateSpeed*t;this.actionStates.ROTATE_UP&&(this._spherical.phi+=this.actionStates.ROTATE_UP*i),this.actionStates.ROTATE_DOWN&&(this._spherical.phi-=this.actionStates.ROTATE_DOWN*i),this.actionStates.ROTATE_RIGHT&&(this._spherical.theta-=this.actionStates.ROTATE_RIGHT*i),this.actionStates.ROTATE_LEFT&&(this._spherical.theta+=this.actionStates.ROTATE_LEFT*i);const e=this.maxTiltAngle+Math.PI/2,s=this.minTiltAngle+Math.PI/2;this._spherical.phi=Math.max(s,Math.min(e,this._spherical.phi)),this._spherical.makeSafe()}update(t){super.update(t),this._updateAnimation(),this._animationMixer.update(t),this._syncForwardDirection(),this._updateObjectDirection(),this._lerpCameraPosition()}dispose(){super.dispose(),this._animationMixer.stopAllAction(),this._animationMixer.uncacheRoot(this.object)}_onMouseWheel(t){if(!this.enableZoom)return;if(!(this.camera instanceof l||this.camera instanceof d))return console.warn("WARNING: FirstPersonControls.js encountered an unknown camera type - dolly/zoom disabled."),void(this.enableZoom=!1);const i=Math.pow(.95,this.zoomSpeed*Math.abs(.01*t.deltaY));t.deltaY>0?this.camera.zoom*=i:t.deltaY<0&&(this.camera.zoom/=i),this.camera.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.camera.zoom)),this.camera.updateProjectionMatrix()}}function I(t){return class extends t{constructor(...t){super(...t),this.keyToActions={KeyW:["MOVE_FORWARD"],KeyS:["MOVE_BACKWARD"],KeyA:["MOVE_LEFTWARD"],KeyD:["MOVE_RIGHTWARD"],Space:["JUMP"],ShiftLeft:["ACCELERATE"]},this._bindOnKeyDown=this._onKeyDown.bind(this),this._bindOnKeyUp=this._onKeyUp.bind(this),this._bindOnBlur=this._onBlur.bind(this),this.connect()}connect(){super.connect(),window.addEventListener("keydown",this._bindOnKeyDown),window.addEventListener("keyup",this._bindOnKeyUp),window.addEventListener("blur",this._bindOnBlur)}disconnect(){super.disconnect(),window.removeEventListener("keydown",this._bindOnKeyDown),window.removeEventListener("keyup",this._bindOnKeyUp),window.removeEventListener("blur",this._bindOnBlur)}dispose(){super.dispose(),this.disconnect()}_onKeyDown(t){t.code in this.keyToActions&&this.keyToActions[t.code].forEach((t=>{this.actionStates[t]=1}))}_onKeyUp(t){t.code in this.keyToActions&&this.keyToActions[t.code].forEach((t=>{this.actionStates[t]=0}))}_onBlur(){Object.keys(this.keyToActions).forEach((t=>{this.keyToActions[t].forEach((t=>{this.actionStates[t]=0}))}))}}}class Y extends(I(B)){constructor(){super(...arguments),this.keyToActions={KeyW:["MOVE_FORWARD"],KeyS:["MOVE_BACKWARD"],KeyA:["MOVE_LEFTWARD"],KeyD:["MOVE_RIGHTWARD"],Space:["JUMP"],ShiftLeft:["ACCELERATE"],ArrowUp:["ROTATE_UP"],ArrowDown:["ROTATE_DOWN"],ArrowRight:["ROTATE_RIGHT"],ArrowLeft:["ROTATE_LEFT"]}}}function G(t){return class extends t{constructor(...t){super(...t),this.dragXActions=["ROTATE_RIGHT"],this.dragYActions=["ROTATE_DOWN"],this.dragDampingFactor=1,this.enableDragDamping=!0,this._isDragging=!1,this._lastTouchX=0,this._lastTouchY=0,this._bindOnDragStart=this._onDragStart.bind(this),this._bindOnDragEnd=this._onDragEnd.bind(this),this._bindOnDragMove=this._onDragMove.bind(this),this.connect()}connect(){var t,i,e,s;super.connect(),null===(t=this.domElement)||void 0===t||t.addEventListener("mousedown",this._bindOnDragStart),document.addEventListener("mouseup",this._bindOnDragEnd),null===(i=this.domElement)||void 0===i||i.addEventListener("mousemove",this._bindOnDragMove),null===(e=this.domElement)||void 0===e||e.addEventListener("touchstart",this._bindOnDragStart),document.addEventListener("touchend",this._bindOnDragEnd),null===(s=this.domElement)||void 0===s||s.addEventListener("touchmove",this._bindOnDragMove)}disconnect(){var t,i,e,s;super.disconnect(),null===(t=this.domElement)||void 0===t||t.removeEventListener("mousedown",this._bindOnDragStart),document.removeEventListener("mouseup",this._bindOnDragEnd),null===(i=this.domElement)||void 0===i||i.removeEventListener("mousemove",this._bindOnDragMove),null===(e=this.domElement)||void 0===e||e.removeEventListener("touchstart",this._bindOnDragStart),document.removeEventListener("touchend",this._bindOnDragEnd),null===(s=this.domElement)||void 0===s||s.removeEventListener("touchmove",this._bindOnDragMove)}dispose(){super.dispose(),this.disconnect()}update(t){super.update(t),this.enableDragDamping&&(this.dragXActions.forEach((t=>{this.actionStates[t]*=1-this.dragDampingFactor})),this.dragYActions.forEach((t=>{this.actionStates[t]*=1-this.dragDampingFactor})))}_onDragStart(t){if(this._isDragging=!0,t instanceof TouchEvent){const i=t.touches[0];if(!i)return;this._lastTouchX=i.clientX,this._lastTouchY=i.clientY}}_onDragEnd(){this._isDragging=!1}_onDragMove(t){if(!this._isDragging)return;let i=0,e=0;if(t instanceof MouseEvent)i=t.movementX,e=t.movementY;else if(t instanceof TouchEvent){const s=t.touches[0];if(!s)return;i=s.clientX-this._lastTouchX,e=s.clientY-this._lastTouchY,this._lastTouchX=s.clientX,this._lastTouchY=s.clientY}this.dragXActions.forEach((t=>{this.actionStates[t]=i})),this.dragYActions.forEach((t=>{this.actionStates[t]=e}))}}}class H extends(I(G(B))){}function U(t){return class extends t{constructor(...t){super(...t),this.pointerLockXActions=["ROTATE_RIGHT"],this.pointerLockYActions=["ROTATE_DOWN"],this.pointerLockDampingFactor=1,this.enablePointerLockDamping=!0,this._bindOnMouseDown=this._onMouseDown.bind(this),this._bindOnMouseMove=this._onMouseMove.bind(this),this.connect()}connect(){var t,i;super.connect(),null===(t=this.domElement)||void 0===t||t.addEventListener("mousedown",this._bindOnMouseDown),null===(i=this.domElement)||void 0===i||i.addEventListener("mousemove",this._bindOnMouseMove)}disconnect(){var t,i;super.disconnect(),null===(t=this.domElement)||void 0===t||t.removeEventListener("mousedown",this._bindOnMouseDown),null===(i=this.domElement)||void 0===i||i.removeEventListener("mousemove",this._bindOnMouseMove)}dispose(){super.dispose(),this.disconnect()}update(t){super.update(t),this.enablePointerLockDamping&&(this.pointerLockXActions.forEach((t=>{this.actionStates[t]*=1-this.pointerLockDampingFactor})),this.pointerLockYActions.forEach((t=>{this.actionStates[t]*=1-this.pointerLockDampingFactor})))}_onMouseDown(){var t;null===(t=this.domElement)||void 0===t||t.requestPointerLock()}_onMouseMove(t){document.pointerLockElement===this.domElement&&(this.pointerLockXActions.forEach((i=>{this.actionStates[i]=t.movementX})),this.pointerLockYActions.forEach((i=>{this.actionStates[i]=t.movementY})))}}}class X extends(I(U(B))){}class N extends(I(K)){constructor(){super(...arguments),this.keyToActions={KeyW:["MOVE_FORWARD"],KeyS:["MOVE_BACKWARD"],KeyA:["MOVE_LEFTWARD"],KeyD:["MOVE_RIGHTWARD"],Space:["JUMP"],ShiftLeft:["ACCELERATE"],ArrowUp:["ROTATE_UP"],ArrowDown:["ROTATE_DOWN"],ArrowRight:["ROTATE_RIGHT"],ArrowLeft:["ROTATE_LEFT"]}}}class Z extends(I(G(K))){}class q extends(I(U(K))){}class J extends p{constructor(i,e=16777215){super(new y(i.collider.radius,i.collider.length),new A({color:e,toneMapped:!1})),this.type="PhysicsControlsHelper",this._colliderPosition=new t,this.controls=i,this.matrixAutoUpdate=!1,this.frustumCulled=!1,this.update()}update(){this.geometry.dispose(),this.geometry=new y(this.controls.collider.radius,this.controls.collider.length),this.position.copy(this.controls.collider.getCenter(this._colliderPosition)),this.updateMatrix()}dispose(){this.geometry.dispose(),this.material.dispose()}}function Q(t){return class extends t{constructor(...t){super(...t),this.gyroXActions=["MOVE_BACKWARD"],this.gyroXOffset=0,this.gyroXMultiplier=.1,this.gyroYActions=["MOVE_RIGHTWARD"],this.gyroYOffset=0,this.gyroYMultiplier=.1,this.gyroZActions=[],this.gyroZOffset=0,this.gyroZMultiplier=.1,this.needsResetOrientation=!0,this._bindOnDeviceOrientation=this._onDeviceOrientation.bind(this),this._bindRequestDeviceOrientationEvent=this._requestDeviceOrientationEvent.bind(this),this.connect()}connect(){var t;super.connect(),"DeviceOrientationEvent"in window?"requestPermission"in DeviceOrientationEvent&&"function"==typeof DeviceOrientationEvent.requestPermission?null===(t=this.domElement)||void 0===t||t.addEventListener("click",this._bindRequestDeviceOrientationEvent):window.addEventListener("deviceorientation",this._bindOnDeviceOrientation):console.warn("DeviceOrientationEvent is not supported")}disconnect(){var t;super.disconnect(),null===(t=this.domElement)||void 0===t||t.removeEventListener("click",this._bindRequestDeviceOrientationEvent),window.removeEventListener("deviceorientation",this._bindOnDeviceOrientation)}dispose(){super.dispose(),this.disconnect()}_onDeviceOrientation(t){let{alpha:i,beta:e,gamma:s}=t;null!==i&&null!==e&&null!==s&&(this.needsResetOrientation&&(this.gyroXOffset=e,this.gyroYOffset=s,this.gyroZOffset=i,this.needsResetOrientation=!1),e=(e-this.gyroXOffset)*this.gyroXMultiplier,s=(s-this.gyroYOffset)*this.gyroYMultiplier,i=(i-this.gyroZOffset)*this.gyroZMultiplier,this.gyroXActions.forEach((t=>{this.actionStates[t]=e})),this.gyroYActions.forEach((t=>{this.actionStates[t]=s})),this.gyroZActions.forEach((t=>{this.actionStates[t]=i})))}_requestDeviceOrientationEvent(){"requestPermission"in DeviceOrientationEvent&&"function"==typeof DeviceOrientationEvent.requestPermission&&DeviceOrientationEvent.requestPermission().then((t=>{"granted"===t?window.addEventListener("deviceorientation",this._bindOnDeviceOrientation):console.warn("DeviceOrientationEvent.requestPermission() was not granted")})).catch((t=>{console.error(t)}))}}}export{j as Collider,G as DragMixin,Y as FPKeyboardControls,H as FPKeyboardDragControls,X as FPKeyboardPointerLockControls,B as FirstPersonControls,Q as GyroMixin,I as KeyboardMixin,z as PhysicsControls,J as PhysicsControlsHelper,U as PointerLockMixin,N as TPKeyboardControls,Z as TPKeyboardDragControls,q as TPKeyboardPointerLockControls,K as ThirdPersonControls};
